# 8장. SQL 응용

### DDL(Data Define Language)

DB 를 구축하거나 수정할 목적으로 사용하는 언어

CREATE

- CREATE SCHEMA 스키마명 AUTHORIZATION 사용자_id  ( 스키마 정의문 )
- CREATE DOMAIN 도메인명 AS 데이터_타입 DEFAULT 기본값 CONSTRAINT 제약조건명 CHECK (범위값)
- CREATE TABLE
- CREATE VIEW 뷰명 (속성명, … ) AS SELECT  FROM WHERE
- CREATE [UNIQUE] INDEX 인덱스명 ON 테이블명(속성명 ASC | DESC)

ARTER

- ALTER TABLE 테이블명 ADD 속성명    (새로운 속성을 추가)
- ALTER TABLE 테이블명 ALTER 속성명 SET DEFAULT (특정 속성의 DEFAULT 값 변경)
- ALTER TABLE 테이블명 DROP COLUMN 속성명   (특정 속성 삭제)

DROP

- DROP SCHEMA
- DROP DOMAIN
- DROP TABLE
- DROP VIEW
- DROP INDEX
- DROP CONSTRAINT

### DCL(Data Control Language)

데이터의 보안, 무결성, 회복, 병행 제어 등을 제어하는데 사용하는 언어

COMMIT : 트랜잭션이 수행한 내용을 데이터베이스에 반영

ROLLBACK : 변경되었으나 아직 COMMIT 되지 않은 모든 내용들을 취소하고 이전 상태로 되돌리기

SAVEPOINT : 트랜잭션 내에 ROLLBACK 할 위치인 저장점을 지정하는 명령어

GRANT : 사용자에게 권한 부여

- GRANT 사용자 등급 TO 사용자_ID 리스트
- GRANT 권한리스트 ON (고객) TO (NABI) WITH GRANT OPTION

REVOKE : 사용자 권한 취소

- REVOKE 사용자등급 FROM 사용자_ID 리스트
- REVOKE 권한 리스트 ON (고객) FROM (STAR)

### DML(Data Manipulation Language)

저장된 데이터를 실질적으로 관리하는데 사용되는 언어

SELECT : 검색

INSERT : 삽입

- INSERT INTO 테이블명(속성명 … ) VALUES (데이터 …)  ( 모든 속성을 사용할 때는 속성명 생략 가능 )

DELETE : 삭제

- DELETE FROM 테이블명

UPDATE : 갱신

- UPDATE 테이블명 SET 속성명 = 데이터 [WHJRE 조건]

### DML - SELECT-1

SELECT DISTINCT 컬럼 FROM 테이블명

WHERE 조건

GROUP BY 속성명

HAVING 조건

ORDER BY 정렬조건(기본ASC)

DISTINCT : 중복된 튜플이 있으면 그 중 첫 번째 한 개만 표시

GROUP BY : 특정 속성을 기준으로 그룹화하여 검색할 때 사용

HAVING : GROUP BY와 함께 사용되며, 그룹에 대한 조건을 지정함

▶ 조건 연산자

| 비교연산자 | <> 같지 않다 >= 크거나 같다 <= 작거나 같다 |
| --- | --- |
| 논리연산자 | NOT, AND, OR |
| LIKE연산자 | % 모든문자 _문자하나 #숫자하나 |

▶그룹함수 GROUP BY

| COUNT | 그룹별 튜플 수 |
| --- | --- |
| SUM | 그룹별 합계 |
| AVG | 그룹별 평균 |
| MAX | 그룹별 최대값 |
| MIN | 그룹별 최소값 |
| STDDEV | 그룹별 표준편하 |
| VARIANCE | 그룹별 분산 |
| ROLLUP | 그룹별 소계구하는 함수 / 하위레벨에서 상위레벨순 / 하위→상위 순 |
| CUBE | 그룹별 소계구하는 함수 / 상위레벨에서 하위레벨순 / 상위→하위 순 |

▶WINDOW함수

| ROW_NUMBER() | 윈도우별로 각 레코드에 대한 일련번호를 반환 |
| --- | --- |
| RANK() | 윈도우별로 순위를 반환하며, 공동 순위 반영 |
| DENSE_RANK() | 윈도우별로 순위를 반환하여 공동 순위 무시 |

▶집합연산자

| UNION | 합집합 | 두 SELECT문의 조회 결과를 통합하여 모두 출력중복 행은 한번만 출력 |
| --- | --- | --- |
| UNION ALL | 합집합 | 두 SELECT문의 조회 결과를 통합하여 모두 출력중복 행도 모두 출력 |
| INTERSECT | 교집합 | 두 SELECT문의 조회 결과중 공통된 행만 출력 |
| EXCEPT | 차집합 | 첫 번째 SELECT문의 조회 결과에서 두 번째 SELECT문의 조회 결과를 제외한 행을 출력함 |

### JOIN

연관된 튜플들을 결합하여, 하나의 새로운 릴레이션을 반환

- **INTER JOIN**
    - NATURAL JOIN: 중복된 속성을 제거하여 같은 속성을 한 번만 표기하는 방법

```sql
/* WHERE절을 이용한 EQUI JOIN의 표기 형식 */
SELECT [테이블명1.]속성명, [테이블2.]속성명,---
FROM 테이블명1, 테이블명2
WHERE 테이블명1.속성명 = 테이블2.속성명2;

```

```sql
/* NATURAL JOIN절을 이용한 EQUI JOIN의 표기 형식 */
SELECT [테이블명1.]속성명, [테이블2.]속성명,---
FROM 테이블명1 NATURAL JOIN 테이블명2;

```

- **OUTER JOIN**
    - LEFT OUTER JOIN: 좌측 릴레이션에 우측 릴레이션을 합치고 없는 데이터는 NULL로 표시
    - RIGHT OUTER JOIN: 우측 릴레이션에 좌측 릴레이션을 합치고 없는 데이터는 NULL로 표시
    - FULL OUTER JOIN: 양측으로 한번씩 비교 후 없는 데이터는 NULL로 표시

**프로시저**

- SQL을 사용하여 작성한 일련의 작업을 저장해두고 호출을 통해 원할 때마다 저장한 작업을 수행하도록 하는 절차형 SQL
- 일일 마감 작업, 일괄(Batch) 작업 등에 주로 이용